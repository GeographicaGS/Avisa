$(document).ready(function(){var q=new OpenLayers.Map("mapa");var c=new OpenLayers.Layer.Google("Google Streets",{type:"styled",numZoomLevels:22});q.addLayers([c]);var b=[{featureType:"all",elementType:"all",stylers:[{saturation:-100}]}];var r=new google.maps.StyledMapType(b);c.mapObject.mapTypes.set("styled",r);var j={1:"Socios CESEAND",2:"Agentes Generadores de conocimiento",3:"Centros Tecnológicos y de Investigación",4:"Cámaras de Comercio, Industria y Navegación",5:"Clusters",6:"Asociaciones empresariales / Federaciones",7:"Espacios Tecnológicos y de Conocimiento",8:"Redes",9:"Entidades de Gestión",10:"Otras entidades"};var d=new OpenLayers.Projection("EPSG:4326");var k=q.getProjectionObject();var n=new OpenLayers.LonLat(-5.072,37.282).transform(d,k);var a=8;q.setCenter(n,a);var s;var i=new OpenLayers.Layer.Vector("Overlay");$(colaboradores.features).each(function(t,v){var u=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(v.geometry.coordinates[0],v.geometry.coordinates[1]).transform(d,k),{description:v.properties},{externalGraphic:"img/market_0.png",graphicHeight:28,graphicWidth:22,graphicXOffset:-12,graphicYOffset:-25,cursor:"pointer",display:""});i.addFeatures(u)});q.addLayer(i);var l={selector:new OpenLayers.Control.SelectFeature(i,{onSelect:g})};$(".closePopUp").on("click",function(){m();h();l.selector.unselectAll()});$(".imageSearch").on("click",function(t){t.stopPropagation();$(".inputSearch").show();$(".imageClose").show();$(".inputSearch").focus();$("#project").hide();$("#mapa").hide();$("#search").show();$(this).hide();$(".inputSearch").trigger(jQuery.Event("keyup"))});$(".imageClose").on("click",function(){o()});$(".inputSearch").on("click",function(t){t.stopPropagation();$(".inputSearch").show()});var p=(function(){var t=0;return function(v,u){clearTimeout(t);t=setTimeout(v,u)}})();$(".inputSearch").keyup(function(w){w.stopPropagation();var t="";var v=new Array();var u=$(".filtroOpen .row .active").parent().map(function(){return parseInt($(this).attr("id_type"))});$(colaboradores.features).each(function(x,y){if((y.properties.nombre.toLowerCase().indexOf($(".inputSearch").val().toLowerCase())!==-1)&&($.inArray(y.properties.tipo,u)!==-1)){t+="<p index="+x+">"+y.properties.nombre+"</p>";v[x]=y.properties}});$(".searchResult").html(t);$("#search .count").text($(".searchResult").find("p").length+" resultados");$(".searchResult p").unbind().bind("click",function(){o();var x=v[$(this).attr("index")];$(q.layers[1].features).each(function(z,A){var y=0;if(A.attributes.description==x){g(A)}});q.setCenter(new OpenLayers.LonLat(v[$(this).attr("index")].coordx,v[$(this).attr("index")].coordy).transform(d,k),17)});p(function(){},300)});$(".filtro").on("click",function(){$(this).fadeOut();$(".filtroOpen").addClass("active")});$(".filtroOpen .closeLeyend").on("click",function(){$(".filtroOpen").removeClass("active");$(".filtro").fadeIn(750)});$(".filtroOpen .row").on("click",function(){$(this).children().toggleClass("active");var t=$(".filtroOpen .row .active").parent().map(function(){return parseInt($(this).attr("id_type"))});$(i.features).each(function(u,v){if($.inArray(v.attributes.description.tipo,t)>=0){v.style.display=""}else{v.style.display="none"}});i.redraw();$(".inputSearch").trigger(jQuery.Event("keyup"))});function o(){$("#search").hide();$("#project").hide();$("#mapa").show();$(".select").removeClass("select");$(".menu[id_menu='mapa']").addClass("select");$(".inputSearch").hide();$(".imageClose").hide();$(".imageSearch").show()}q.addControl(l.selector);function g(t){var u=10;if(q.getZoom()<10){q.setCenter(new OpenLayers.LonLat(t.geometry.x,t.geometry.y),u)}m();t.style.externalGraphic="img/market.png";s=t;i.redraw();e(t.attributes.description)}function e(t){$(".popup").fadeIn();f($(".popup .title"),t.nombre);f($(".popup .description"),t.objetivos);f($(".popup .dir"),t.direccion+"<br/>CP "+t.cp);f($(".popup .location"),t.municipio);f($(".popup .phone"),t.telefono);f($(".popup .email a"),t.mail);f($(".popup .url a"),t.web);if(t.mail){$(".popup .email a").attr("href","mailto:"+t.mail);$(".popup .email a").show();$(".popup .email").show()}else{$(".popup .email a").hide();$(".popup .email").hide()}if(t.web){$(".popup .url a").attr("href",t.web);$(".popup .url a").show();$(".popup .url").show()}else{$(".popup .url a").hide();$(".popup .url").hide()}$(".popup .content h3").html("<span>TIPO: </span>"+j[t.tipo])}function f(u,t){if(t){u.html(t);u.show()}else{u.hide()}}function m(){if(s){s.style.externalGraphic="img/market_0.png";i.redraw()}}function h(){$(".popup").hide()}$(".menu").on("click",function(){$(".select").removeClass("select");$(this).addClass("select");$("#mapa").hide();$("#project").hide();$("#search").hide();$("#"+$(this).attr("id_menu")).show();$(".inputSearch").hide();$(".imageClose").hide();$(".imageSearch").show();if($(this).attr("id_menu")=="mapa"){q.setCenter(n,a);if(!$(".filtroOpen").hasClass("active")){$(".filtro").show()}$(".filtroOpen").show()}else{$(".filtro").hide();$(".filtroOpen").hide()}});l.selector.activate()});